<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Vault | Secure Notes & Drive</title>
  <meta name="description" content="Your personal secure vault for notes and file storage by Dhruv Shah">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" ondrop="handleDrop(event)">

  <div id="loader">
    <div class="spinner"></div>
    <div style="font-family:var(--mono);font-size:.7rem;color:var(--text3);letter-spacing:2px">PERSONAL VAULT</div>
  </div>

  <div id="toast"><i id="toast-icon" class="ri-information-line"></i><span id="toast-msg"></span></div>

  <!-- AUTH -->
  <div id="auth-screen">
    <div class="auth-box">
      <div class="auth-logo">Personal Vault</div>
      <div class="auth-sub">by Dhruv Shah</div>
      <div class="input-wrap"><input type="email" id="email" class="input-field" placeholder="Email"></div>
      <div class="input-wrap"><input type="password" id="pass" class="input-field" placeholder="Password"
          onkeydown="if(event.key==='Enter')login()"></div>
      <button id="login-btn" class="btn-primary" onclick="login()">Sign In</button>
      <p id="auth-err" class="auth-err"></p>
    </div>
  </div>

  <!-- APP -->
  <div id="app">
    <nav id="sidebar">
      <div class="sb-brand"><i class="ri-shield-keyhole-fill" style="color:var(--primary)"></i><span>Vault</span></div>
      <div class="sb-section">Main</div>
      <div class="nav-item active" data-view="drive" onclick="switchView('drive')"><i
          class="ri-hard-drive-2-line"></i>Drive</div>
      <div class="nav-item" data-view="notes" onclick="switchView('notes')"><i class="ri-file-text-line"></i>Notes</div>
      <div class="sb-section">System</div>
      <div class="nav-item" onclick="openGrammar()"><i class="ri-text"></i>Grammar Check</div>
      <div class="nav-item" data-view="trash" onclick="switchView('trash')"><i class="ri-delete-bin-line"></i>Trash<span
          class="badge hidden" id="trash-badge">0</span></div>

      <div class="sb-bottom">
        <div class="theme-toggle" onclick="toggleTheme()"><i id="theme-icon" class="ri-moon-line"></i><span
            id="theme-label">Dark Mode</span></div>
        <div class="user-card">
          <div class="avatar" id="u-avatar">U</div>
          <div style="overflow:hidden">
            <div class="user-email" id="u-email">user</div>
          </div>
          <button class="logout-btn" onclick="logout()" title="Sign out"><i class="ri-logout-box-r-line"></i></button>
        </div>
      </div>
    </nav>

    <main id="main">
      <!-- DRIVE -->
      <div id="view-drive" style="display:flex;flex-direction:column;height:100%">
        <div class="topbar">
          <div class="topbar-left">
            <i class="ri-home-4-fill" onclick="currentPath='/';refreshDrive()"></i>
            <span>/</span><span class="crumb" id="crumb-text">Home</span>
          </div>
          <div class="topbar-right">
            <div class="view-toggle">
              <button class="active" onclick="setViewMode('grid')"><i class="ri-grid-fill"></i></button>
              <button onclick="setViewMode('list')"><i class="ri-list-unordered"></i></button>
            </div>
            <select class="sort-select" onchange="setSortBy(this.value)">
              <option value="name">Name</option>
              <option value="date">Date</option>
            </select>
            <div class="icon-btn" onclick="createFolder()" title="New Folder"><i class="ri-folder-add-line"></i></div>
            <div class="icon-btn" onclick="document.getElementById('file-up').click()" title="Upload"><i
                class="ri-upload-cloud-2-line"></i></div>
            <input type="file" id="file-up" hidden multiple onchange="uploadFiles(this.files)">
          </div>
        </div>
        <div class="drive-area">
          <div id="drive-grid" class="drive-grid"></div>
          <div class="drop-zone">Drop files to upload</div>
        </div>
      </div>

      <!-- NOTES -->
      <div id="view-notes" class="hidden">
        <div class="notes-sidebar">
          <div class="notes-head">
            <div class="notes-head-top">
              <h3>Notes</h3>
              <div class="icon-btn" onclick="createNote()" title="New Note"><i class="ri-add-line"></i></div>
            </div>
            <input type="text" class="notes-search" placeholder="Search notes..." oninput="filterNotes(this.value)">
          </div>
          <div id="notes-list"></div>
        </div>
        <div class="editor-area">
          <div id="lock-screen" class="lock-screen hidden">
            <i class="ri-lock-2-fill"></i>
            <h2>Protected Note</h2>
            <input type="password" id="unlock-pw" class="input-field" placeholder="Password"
              style="width:200px;text-align:center;margin-top:8px">
            <button class="btn-primary" style="width:200px;margin-top:8px" onclick="unlockNote()">Unlock</button>
          </div>
          <div class="editor-bar">
            <button class="tool-btn" onclick="insertMD('**')" title="Bold"><i class="ri-bold"></i></button>
            <button class="tool-btn" onclick="insertMD('*')" title="Italic"><i class="ri-italic"></i></button>
            <button class="tool-btn" onclick="insertMD('`')" title="Code"><i class="ri-code-s-slash-line"></i></button>
            <button class="tool-btn" onclick="toggleFocus()" title="Focus"><i class="ri-fullscreen-line"></i></button>
            <div class="tool-sep"></div>
            <button class="tool-btn" id="btn-lock" onclick="toggleLock()" title="Lock"><i
                class="ri-lock-unlock-line"></i></button>
            <div class="editor-info">
              <span id="word-count">0 words</span>
              <span id="save-status"><span class="save-dot"></span>Saved</span>
            </div>
          </div>
          <input id="note-title" placeholder="Untitled" oninput="triggerSave()">
          <textarea id="note-body" placeholder="Start writing..." oninput="handleNoteInput(this)"></textarea>
        </div>
      </div>

      <!-- TRASH -->
      <div id="view-trash" class="hidden" style="display:flex;flex-direction:column;height:100%">
        <div class="topbar">
          <div class="topbar-left"><i class="ri-delete-bin-line"></i><span class="crumb">Trash</span></div>
          <div class="topbar-right">
            <div class="icon-btn" onclick="emptyTrash()" title="Empty Trash"><i class="ri-delete-bin-fill"
                style="color:var(--danger)"></i></div>
          </div>
        </div>
        <div class="trash-list" id="trash-content"></div>
      </div>
    </main>
  </div>

  <div id="ctx-menu" class="ctx-menu hidden"></div>
  <script src="app.js"></script>
</body>

</html>