<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personal Vault</title>
  <meta name="description" content="Personal Vault — Secure notes and file storage by Dhruv Shah">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <!-- LOADER -->
  <div id="loader"
    style="position:fixed;inset:0;background:#09090b;z-index:9999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;transition:opacity .4s">
    <div
      style="width:24px;height:24px;border:2px solid #27272e;border-top-color:#5b8def;border-radius:50%;animation:spin .6s infinite linear">
    </div>
    <span
      style="font-size:.65rem;color:#5a5a6e;letter-spacing:2px;font-weight:600;font-family:Inter,system-ui,sans-serif">PERSONAL
      VAULT</span>
  </div>

  <!-- TOAST -->
  <div id="toast"
    style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(60px);background:#1c1c21;border:1px solid #27272e;padding:10px 18px;border-radius:10px;color:#e4e4ec;display:flex;align-items:center;gap:8px;box-shadow:0 8px 24px rgba(0,0,0,.4);opacity:0;transition:.3s cubic-bezier(.16,1,.3,1);z-index:5000;font-size:.82rem;white-space:nowrap;font-family:Inter,system-ui,sans-serif">
    <i id="ti"></i><span id="tm"></span>
  </div>

  <!-- AUTH SCREEN - fully inline styled for reliability -->
  <div id="auth"
    style="position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;z-index:1000;display:flex;align-items:center;justify-content:center;background:#000;font-family:Inter,system-ui,sans-serif">
    <div
      style="width:400px;max-width:90vw;padding:48px 40px;border:1px solid #27272e;border-radius:16px;background:linear-gradient(145deg,rgba(21,21,24,.95),rgba(12,12,15,.98));backdrop-filter:blur(20px);text-align:center">
      <h1 style="font-size:1.8rem;font-weight:800;letter-spacing:-1px;margin:0 0 2px;color:#e4e4ec">Personal Vault</h1>
      <div style="font-size:.72rem;color:#5a5a6e;letter-spacing:2px;text-transform:uppercase;margin-bottom:32px">Secure
        · Private · Yours</div>
      <input type="email" id="em" placeholder="Email"
        style="width:100%;padding:13px 16px;background:#09090b;border:1.5px solid #27272e;border-radius:10px;color:#e4e4ec;font-size:.88rem;margin-bottom:12px;outline:none;font-family:Inter,system-ui,sans-serif;box-sizing:border-box">
      <input type="password" id="pw" placeholder="Password" onkeydown="if(event.key==='Enter')login()"
        style="width:100%;padding:13px 16px;background:#09090b;border:1.5px solid #27272e;border-radius:10px;color:#e4e4ec;font-size:.88rem;margin-bottom:12px;outline:none;font-family:Inter,system-ui,sans-serif;box-sizing:border-box">
      <button id="lbtn" onclick="login()"
        style="width:100%;padding:13px;background:#5b8def;color:#fff;border:none;border-radius:10px;font-weight:700;font-size:.88rem;cursor:pointer;letter-spacing:.3px;margin-top:4px;font-family:Inter,system-ui,sans-serif">SIGN
        IN</button>
      <div id="aerr" style="color:#e5484d;font-size:.76rem;margin-top:10px;min-height:18px"></div>
    </div>
  </div>

  <!-- APP -->
  <div id="app" style="width:100%;height:100vh;display:none;flex-direction:row">
    <aside id="side">
      <div class="side-tabs">
        <div class="side-tab on" id="tab-notes" onclick="switchTab('notes')">NOTES</div>
        <div class="side-tab" id="tab-files" onclick="switchTab('files')">FILES</div>
      </div>

      <div id="panel-notes">
        <div class="side-actions">
          <button class="act-btn act-new" onclick="createNote()"><i class="ri-add-line"></i>NEW NOTE</button>
          <button class="act-btn act-fold" onclick="createNoteFolder()"><i class="ri-folder-add-line"></i>NEW
            FOLDER</button>
        </div>
        <div class="side-list" id="sidebar-notes"></div>
      </div>

      <div id="panel-files" class="hide">
        <div class="side-actions">
          <button class="act-btn act-new" onclick="document.getElementById('fup').click()"><i
              class="ri-upload-2-line"></i>UPLOAD FILE</button>
          <button class="act-btn act-fold" onclick="createDriveFolder()"><i class="ri-folder-add-line"></i>NEW
            FOLDER</button>
          <input type="file" id="fup" hidden multiple onchange="uploadFiles(this.files)">
        </div>
        <div class="side-list" id="sidebar-files"></div>
      </div>

      <div class="side-bottom">
        <div class="sb-item" onclick="openGrammar()"><i class="ri-quill-pen-line"></i>Grammar Check</div>
        <div class="sb-item" onclick="showTrash()"><i class="ri-delete-bin-5-line"></i>Trash<span class="cnt hide"
            id="tcnt">0</span></div>
        <div class="sb-user">
          <div class="sb-av" id="uav">D</div>
          <div class="sb-email" id="uemail">user</div><button class="sb-out" onclick="logout()" title="Sign out"><i
              class="ri-logout-box-r-line"></i></button>
        </div>
      </div>
    </aside>

    <main id="main">
      <!-- EDITOR -->
      <div id="editor-wrap">
        <div id="lock-wall" class="lock-wall hide">
          <i class="ri-lock-2-fill"></i>
          <h2>This note is locked</h2>
          <input type="password" id="lockpw" placeholder="Enter password">
          <button onclick="unlockNote()">Unlock</button>
        </div>
        <div id="e-empty" class="e-empty">
          <i class="ri-file-text-line"></i>
          <p>Select a note or create a new one</p>
          <span>Use the sidebar to get started</span>
        </div>
        <div id="e-ui" class="hide" style="display:flex;flex-direction:column;flex:1">
          <div class="e-bar">
            <button class="tb" onclick="insertMD('**')" title="Bold"><i class="ri-bold"></i></button>
            <button class="tb" onclick="insertMD('*')" title="Italic"><i class="ri-italic"></i></button>
            <button class="tb" onclick="insertMD('`')" title="Code"><i class="ri-code-s-slash-line"></i></button>
            <button class="tb" onclick="insertMD('~~')" title="Strikethrough"><i class="ri-strikethrough"></i></button>
            <div class="sep"></div>
            <button class="tb" id="lockbtn" onclick="toggleLock()" title="Lock"><i
                class="ri-lock-unlock-line"></i></button>
            <button class="tb" onclick="toggleFocus()" title="Focus mode"><i class="ri-focus-3-line"></i></button>
            <div class="e-meta"><span id="wc">0 words</span><span id="ss"><span class="dot"></span>Saved</span></div>
          </div>
          <input id="et" placeholder="Untitled" oninput="triggerSave()">
          <textarea id="eb" placeholder="Start writing..." oninput="handleInput(this)"></textarea>
        </div>
      </div>

      <!-- DRIVE -->
      <div id="view-drive" class="hide" style="flex-direction:column;height:100%">
        <div class="topbar">
          <div class="tb-l"><i class="ri-home-5-fill" onclick="drivePath='/';refreshDrive()"
              style="cursor:pointer"></i><span>/</span><span class="p" id="dp">Home</span></div>
          <div class="tb-r">
            <div class="ib" onclick="setDriveView('grid')"><i class="ri-layout-grid-fill"></i></div>
            <div class="ib" onclick="setDriveView('list')"><i class="ri-list-check"></i></div>
            <select class="sel" onchange="driveSortBy=this.value;refreshDriveGrid()">
              <option value="name">Name</option>
              <option value="date">Date</option>
              <option value="size">Size</option>
            </select>
          </div>
        </div>
        <div class="drive-area" style="position:relative">
          <div id="dgrid" class="dg"></div>
          <div class="drop-ov"><i class="ri-upload-cloud-2-line" style="font-size:2rem"></i> Drop files here</div>
        </div>
      </div>

      <!-- TRASH -->
      <div id="view-trash" class="hide" style="flex-direction:column;height:100%">
        <div class="topbar">
          <div class="tb-l"><i class="ri-delete-bin-5-line"></i><span class="p">Trash</span></div>
          <div class="tb-r">
            <div class="ib" onclick="emptyTrash()" style="color:#e5484d"><i
                class="ri-delete-bin-fill"></i><span>Empty</span></div>
          </div>
        </div>
        <div class="trash-area" id="tlist"></div>
      </div>
    </main>
  </div>

  <div id="ctx" class="hide"></div>
  <div id="modal-root"></div>
  <style>
    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }
  </style>
  <script src="app.js"></script>
</body>

</html>